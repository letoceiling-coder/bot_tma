/**
 * ============================================================
 * Точка входа Vue.js приложения
 * ============================================================
 *
 * Этот файл инициализирует Vue 3 приложение с Composition API,
 * подключает глобальные компоненты, роутер, Vuex store и плагины.
 *
 * @file resources/js/app.js
 * @author CRM Team
 * @version 1.0.0
 * 
 * @requires vue ^3.4.0 - Основная библиотека Vue.js 3
 * @requires vuex ^4.0.0 - Управление состоянием приложения
 * @requires vue-router ^4.0.0 - Маршрутизация SPA
 * @requires @kyvg/vue3-notification - Система уведомлений
 * @requires axios - HTTP клиент для API запросов
 */

// ============================================================
// Импорт зависимостей
// ============================================================

/**
 * Vue3-notification - библиотека для отображения уведомлений
 * Используется для toast-сообщений об успехе, ошибках и предупреждениях
 * 
 * @example
 * this.$notify({
 *   title: 'Успех',
 *   text: 'Операция выполнена успешно',
 *   type: 'success'
 * });
 */
import Notifications from '@kyvg/vue3-notification'

/**
 * Bootstrap - настройка Axios, CSRF токены, глобальные настройки
 * 
 * Инициализирует:
 * - Axios с baseURL и заголовками
 * - CSRF токен для защиты от атак
 * - Interceptors для обработки ошибок
 * - Echo для WebSocket (если используется)
 * 
 * @see resources/js/bootstrap.js
 */
import './bootstrap';

/**
 * Vue 3 - главная библиотека для создания реактивного UI
 * 
 * createApp - фабричная функция для создания экземпляра приложения
 * 
 * @see https://vuejs.org/api/application.html#createapp
 */
import { createApp } from 'vue';

/**
 * Vuex Store - централизованное хранилище состояния приложения
 * 
 * Управляет глобальным состоянием:
 * - user: Данные авторизованного пользователя
 * - settings: Настройки приложения
 * - errors: Список ошибок валидации
 * 
 * Паттерн: State -> Mutations -> Actions -> Getters
 * 
 * @see resources/js/src/store.js
 */
import store from './src/store.js';
import asset from './src/utils/asset.js';

/**
 * Vue Router - маршрутизация SPA приложения
 * 
 * Управляет навигацией между страницами без перезагрузки:
 * - History mode для красивых URL
 * - Навигационные guard'ы для защиты роутов
 * - Мета-данные роутов (title, auth)
 * 
 * @see resources/js/src/route/router.js
 * @see resources/js/src/route/routes.js
 */
import Router from './src/route/router.js';

/**
 * Корневой компонент приложения
 * 
 * Главный компонент, содержащий <router-view> для отображения страниц
 * 
 * @component App
 * @see resources/js/src/App.vue
 */
import App from './src/App.vue';

/**
 * Регистр всех глобальных UI компонентов
 * 
 * Включает компоненты, доступные во всём приложении без импорта:
 * - Формы: mc-input, mc-phone, mc-select, mc-textarea
 * - Медиа: MediaManager, btn-media
 * - Страницы: mc-main, login, register, forget
 * - Утилиты: mc-error
 * 
 * @see resources/js/src/UI/register.js
 */
import registerComponents from './src/UI/register.js';

/**
 * Глобальный миксин Storage
 * 
 * Предоставляет реактивное хранилище this.storage для всех компонентов.
 * Используется для временных данных UI (состояние медиа-менеджера, фильтры и т.д.)
 * 
 * @mixin storage
 * @see resources/js/src/mixins/storage.js
 * 
 * @example Использование
 * this.storage.media = { folders: [], current: null };
 * const folders = this.storage.media?.folders || [];
 */
import storageMixin from './src/mixins/storage.js';

// ============================================================
// Создание экземпляра Vue приложения
// ============================================================

/**
 * Создаём корневое приложение Vue 3
 * 
 * Все плагины и компоненты должны быть зарегистрированы
 * ПЕРЕД вызовом app.mount('#app')
 * 
 * @constant {App} app - Экземпляр Vue приложения
 * @see https://vuejs.org/api/application.html
 */
const app = createApp(App);

/**
 * Подключаем систему уведомлений Vue3-notification
 * 
 * Добавляет глобальный метод this.$notify() для показа toast-уведомлений
 * 
 * @example
 * this.$notify({
 *   title: 'Успех!',
 *   text: 'Данные сохранены',
 *   type: 'success',
 *   duration: 3000
 * });
 */
app.use(Notifications)

/**
 * Подключаем глобальный миксин Storage
 * 
 * После подключения все компоненты получают доступ к this.storage
 * Миксин добавляется ПЕРЕД регистрацией компонентов, чтобы они могли его использовать
 * 
 * @see resources/js/src/mixins/storage.js
 */
app.mixin(storageMixin);
app.mixin({
    methods: {
        asset(path) {
            return asset(path);
        },
    },
});

// ============================================================
// Регистрация глобальных компонентов
// ============================================================

/**
 * Автоматическая регистрация всех UI компонентов из register.js
 * 
 * Компоненты регистрируются глобально, что позволяет использовать их
 * в любом месте приложения без дополнительного импорта.
 * 
 * ┌─────────────────────────────────────────────────────────────┐
 * │ Категория: Уведомления и ошибки                             │
 * ├─────────────────────────────────────────────────────────────┤
 * │ mc-error - Компонент отображения ошибок валидации           │
 * └─────────────────────────────────────────────────────────────┘
 * 
 * ┌─────────────────────────────────────────────────────────────┐
 * │ Категория: Поля ввода                                       │
 * ├─────────────────────────────────────────────────────────────┤
 * │ mc-input - Текстовое поле ввода (text, email, password)    │
 * │ mc-phone - Поле ввода телефона с маской                     │
 * │ mc-textarea - Многострочное текстовое поле                  │
 * └─────────────────────────────────────────────────────────────┘
 * 
 * ┌─────────────────────────────────────────────────────────────┐
 * │ Категория: Выпадающие списки                                │
 * ├─────────────────────────────────────────────────────────────┤
 * │ mc-option - Опция для выпадающего списка                    │
 * │ mc-select - Множественный выбор из списка                   │
 * │ mc-select-one - Одиночный выбор из списка                   │
 * │ mc-select-too - Альтернативный компонент выбора             │
 * └─────────────────────────────────────────────────────────────┘
 * 
 * ┌─────────────────────────────────────────────────────────────┐
 * │ Категория: Медиа-менеджер                                   │
 * ├─────────────────────────────────────────────────────────────┤
 * │ btn-media - Кнопка для открытия медиа-менеджера             │
 * │ MediaManager - Полнофункциональный менеджер медиафайлов     │
 * └─────────────────────────────────────────────────────────────┘
 * 
 * ┌─────────────────────────────────────────────────────────────┐
 * │ Категория: Шаблоны страниц                                  │
 * ├─────────────────────────────────────────────────────────────┤
 * │ mc-main - Главный layout с навигацией и sidebar             │
 * │ login - Страница входа в систему                            │
 * │ register - Страница регистрации нового пользователя         │
 * │ forget - Страница восстановления пароля                     │
 * └─────────────────────────────────────────────────────────────┘
 * 
 * @see resources/js/src/UI/register.js
 * 
 * @example Использование глобальных компонентов
 * <template>
 *   <mc-input v-model="form.name" placeholder="Введите имя" />
 *   <btn-media @selected="handleMedia" />
 * </template>
 */
for (const [componentName, component] of Object.entries(registerComponents)) {
    app.component(componentName, component);
}

// ============================================================
// Подключение плагинов
// ============================================================

/**
 * Vuex Store - управление глобальным состоянием приложения
 * 
 * Централизованное хранилище данных, доступное из любого компонента.
 * 
 * ┌─────────────────────────────────────────────────────────────┐
 * │ State (состояние):                                          │
 * ├─────────────────────────────────────────────────────────────┤
 * │ • user: Данные авторизованного пользователя                 │
 * │   - id, name, email, role, permissions                      │
 * │                                                             │
 * │ • settings: Настройки приложения                            │
 * │   - app_name, locale, theme, currency                       │
 * │                                                             │
 * │ • errors: Список ошибок валидации                           │
 * │   - { field, message }                                      │
 * └─────────────────────────────────────────────────────────────┘
 * 
 * @example Доступ к store в компоненте
 * // Получить данные
 * this.$store.state.user
 * 
 * // Изменить данные (через mutations)
 * this.$store.commit('setUser', userData)
 * 
 * // Асинхронные действия (через actions)
 * this.$store.dispatch('fetchUser')
 * 
 * // Геттеры (вычисляемые свойства)
 * this.$store.getters.isAuthenticated
 * 
 * @see resources/js/src/store.js
 */
app.use(store);

/**
 * Vue Router - клиентская маршрутизация (SPA)
 * 
 * Управляет навигацией между страницами без перезагрузки браузера.
 * Использует History API для красивых URL без "#".
 * 
 * ┌─────────────────────────────────────────────────────────────┐
 * │ Основные маршруты приложения:                               │
 * ├─────────────────────────────────────────────────────────────┤
 * │ Публичные (без авторизации):                                │
 * │ • /login - Авторизация пользователя                         │
 * │ • /register - Регистрация нового пользователя               │
 * │ • /forgot-password - Восстановление доступа                 │
 * │                                                             │
 * │ Защищённые (требуют авторизации):                           │
 * │ • / - Главная страница (dashboard)                          │
 * │ • /admin/media - Медиа-менеджер (управление файлами)        │
 * │ • /:template?/:action?/:params? - Динамические роуты        │
 * └─────────────────────────────────────────────────────────────┘
 * 
 * @example Использование роутера в компоненте
 * // Программный переход
 * this.$router.push('/admin/media')
 * this.$router.push({ name: 'admin.media' })
 * 
 * // Получить текущий роут
 * this.$route.path
 * this.$route.params
 * this.$route.query
 * 
 * @see resources/js/src/route/router.js
 * @see resources/js/src/route/routes.js
 */
app.use(Router);

// ============================================================
// Монтирование приложения
// ============================================================

/**
 * Монтируем Vue приложение в DOM
 * 
 * Метод mount() запускает приложение и связывает его с DOM элементом.
 * После монтирования все плагины и компоненты становятся активными.
 * 
 * ВАЖНО: Элемент #app должен существовать в HTML перед монтированием!
 * 
 * @param {string} #app - CSS селектор элемента для монтирования
 * 
 * Элемент находится в:
 * @see resources/views/layouts/app.blade.php
 * @see resources/views/app.blade.php
 * 
 * @example HTML разметка
 * <!DOCTYPE html>
 * <html>
 * <body>
 *   <div id="app"></div>
 *   <script src="/js/app.js"></script>
 * </body>
 * </html>
 * 
 * @throws {Error} Если элемент #app не найден в DOM
 */
app.mount('#app');

// ============================================================
// Приложение успешно инициализировано!
// ============================================================

/**
 * После монтирования доступны:
 * 
 * ✅ Vue Router - навигация между страницами
 * ✅ Vuex Store - глобальное состояние
 * ✅ Notifications - система уведомлений
 * ✅ Глобальные компоненты - формы, медиа-менеджер, шаблоны
 * ✅ Axios - настроенный HTTP клиент
 * ✅ CSRF защита - автоматическая отправка токенов
 * 
 * Для отладки в консоли браузера:
 * - app._instance - экземпляр Vue приложения
 * - app._instance.proxy.$store - доступ к Vuex store
 * - app._instance.proxy.$router - доступ к Vue Router
 */
